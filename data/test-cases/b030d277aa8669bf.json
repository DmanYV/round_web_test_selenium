{"uid":"b030d277aa8669bf","name":"Проверка получения СМС с кодом подтверждения регистрации","fullName":"tests.test_registration.TestRegistrationUser#test_receiving_sms_with_registration_confirmation_code","historyId":"c21c66f75966c5e549a12c63349f9cf5","time":{"start":1721683237309,"stop":1721683252700,"duration":15391},"status":"broken","statusMessage":"IndexError: list index out of range","statusTrace":"self = <test_registration.TestRegistrationUser object at 0x7fb3f9527500>\nelements = {'Панель навигации': {'Кнопка главная': ('xpath', '//a[@href=\"/\"]'), 'Кнопка лента': ('xpath', '//a[@href=\"/feed\"]'), ..., 'Кнопка запросить код еще раз': ('xpath', '//button[@class=\"button_content__7wfbm button_light__j7a6Y\"]'), ...}, ...}\n\n    @allure.title('Проверка получения СМС с кодом подтверждения регистрации')\n    @allure.severity('Critical')\n    @pytest.mark.regression\n    def test_receiving_sms_with_registration_confirmation_code(self, elements):\n        with allure.step('Открыть страницу авторизации'):\n            self.authorization_page.open()\n            element = elements['Страница авторизации']\n    \n        with allure.step('Нажать кнопку \"По смс (Для России)\"'):\n            self.authorization_page.do_click(element['Кнопка по смс'])\n    \n        with allure.step('Нажать кнопку Далее'):\n            element = elements['Страница регистрации']\n            self.join_page.do_click(element['Кнопка далее'])\n    \n        with allure.step('В поле никнейм ввести любое валидное значение'):\n            username = f'-{fake.user_name()}.{fake.pyint(min_value=1, max_value=2)}_'\n            self.join_page.field_send_keys(element['Поле никнейм'], text=f'{username}')\n    \n        with allure.step('Нажать кнопку Далее'):\n            self.join_page.do_click(element['Кнопка далее'])\n    \n        with allure.step('В поле Пароль ввести пароль'):\n            self.join_page.field_send_keys(element['Поле пароль'], text=self.User.PASSWORD)\n    \n        with allure.step('В поле Повтори пароль ввести пароль еще раз'):\n            self.join_page.field_send_keys(element['Поле повтори пароль'], text=self.User.PASSWORD)\n    \n        with allure.step('Нажать кнопку далее'):\n            self.join_page.do_click(element['Кнопка далее'])\n    \n        with allure.step('Ввести номер телефона в поле номер телефона'):\n            phone_number = fakeru.random_number(digits=10, fix_len=True)\n            self.join_page.field_send_keys(element['Поле номер телефона'], text=phone_number)\n    \n        with allure.step('Нажать кнопку далее'):\n            self.join_page.do_click(element['Кнопка далее'])\n    \n        with allure.step('Авторизоваться в MetaBase'):\n            metabase = self.metabase.authorization(username=self.MetaBaseUser.LOGIN,\n                                                   password=self.MetaBaseUser.PASSWORD)\n    \n        with allure.step('Проверяем, что код пришел'):\n>           sms_code = self.metabase.take_last_code(metabase)\n\ntests/test_registration.py:281: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\ncookies = <RequestsCookieJar[Cookie(version=0, name='metabase.TIMEOUT', value='alive', port=None, port_specified=False, domain='...352835250, discard=False, comment=None, comment_url=None, rest={'HttpOnly': None, 'SameSite': 'None'}, rfc2109=False)]>\n\n    @staticmethod\n    def take_last_code(cookies: RequestsCookieJar) -> str:\n        \"\"\"\n        Метод получения Session_ID в Metabase через API.\n    \n        :param cookies: Куки авторизации\n        :return: last_code: Последний созданный код в таблице\n        \"\"\"\n        cookies = cookies\n        json = {\"type\": \"query\",\n                \"query\": {\"source-table\": 121,\n                          \"filter\": [\"time-interval\",\n                                     [\"field\", 726, None],\n                                     \"current\",\n                                     \"day\",\n                                     {\"include_current\": True}],\n                          \"order-by\": [[\"desc\", [\"field\", 728, None]]]},\n                \"database\": 5,\n                \"parameters\": []}\n        time.sleep(1)\n        response = requests.post(url=MetaBaseLinks.DATA_SATE, cookies=cookies, json=json)\n>       last_code = response.json()['data']['rows'][0][7]\nE       IndexError: list index out of range\n\nmodel/api/metabase.py:53: IndexError","flaky":false,"newFailed":false,"newBroken":true,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"_session_faker","time":{"start":1721683115880,"stop":1721683115901,"duration":21},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"hasContent":false,"attachmentStep":false,"attachmentsCount":0},{"name":"driver","time":{"start":1721683236880,"stop":1721683237308,"duration":428},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"hasContent":false,"attachmentStep":false,"attachmentsCount":0},{"name":"setup","time":{"start":1721683237308,"stop":1721683237309,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"hasContent":false,"attachmentStep":false,"attachmentsCount":0},{"name":"elements","time":{"start":1721683237309,"stop":1721683237309,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"hasContent":false,"attachmentStep":false,"attachmentsCount":0}],"testStage":{"status":"broken","statusMessage":"IndexError: list index out of range","statusTrace":"self = <test_registration.TestRegistrationUser object at 0x7fb3f9527500>\nelements = {'Панель навигации': {'Кнопка главная': ('xpath', '//a[@href=\"/\"]'), 'Кнопка лента': ('xpath', '//a[@href=\"/feed\"]'), ..., 'Кнопка запросить код еще раз': ('xpath', '//button[@class=\"button_content__7wfbm button_light__j7a6Y\"]'), ...}, ...}\n\n    @allure.title('Проверка получения СМС с кодом подтверждения регистрации')\n    @allure.severity('Critical')\n    @pytest.mark.regression\n    def test_receiving_sms_with_registration_confirmation_code(self, elements):\n        with allure.step('Открыть страницу авторизации'):\n            self.authorization_page.open()\n            element = elements['Страница авторизации']\n    \n        with allure.step('Нажать кнопку \"По смс (Для России)\"'):\n            self.authorization_page.do_click(element['Кнопка по смс'])\n    \n        with allure.step('Нажать кнопку Далее'):\n            element = elements['Страница регистрации']\n            self.join_page.do_click(element['Кнопка далее'])\n    \n        with allure.step('В поле никнейм ввести любое валидное значение'):\n            username = f'-{fake.user_name()}.{fake.pyint(min_value=1, max_value=2)}_'\n            self.join_page.field_send_keys(element['Поле никнейм'], text=f'{username}')\n    \n        with allure.step('Нажать кнопку Далее'):\n            self.join_page.do_click(element['Кнопка далее'])\n    \n        with allure.step('В поле Пароль ввести пароль'):\n            self.join_page.field_send_keys(element['Поле пароль'], text=self.User.PASSWORD)\n    \n        with allure.step('В поле Повтори пароль ввести пароль еще раз'):\n            self.join_page.field_send_keys(element['Поле повтори пароль'], text=self.User.PASSWORD)\n    \n        with allure.step('Нажать кнопку далее'):\n            self.join_page.do_click(element['Кнопка далее'])\n    \n        with allure.step('Ввести номер телефона в поле номер телефона'):\n            phone_number = fakeru.random_number(digits=10, fix_len=True)\n            self.join_page.field_send_keys(element['Поле номер телефона'], text=phone_number)\n    \n        with allure.step('Нажать кнопку далее'):\n            self.join_page.do_click(element['Кнопка далее'])\n    \n        with allure.step('Авторизоваться в MetaBase'):\n            metabase = self.metabase.authorization(username=self.MetaBaseUser.LOGIN,\n                                                   password=self.MetaBaseUser.PASSWORD)\n    \n        with allure.step('Проверяем, что код пришел'):\n>           sms_code = self.metabase.take_last_code(metabase)\n\ntests/test_registration.py:281: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\ncookies = <RequestsCookieJar[Cookie(version=0, name='metabase.TIMEOUT', value='alive', port=None, port_specified=False, domain='...352835250, discard=False, comment=None, comment_url=None, rest={'HttpOnly': None, 'SameSite': 'None'}, rfc2109=False)]>\n\n    @staticmethod\n    def take_last_code(cookies: RequestsCookieJar) -> str:\n        \"\"\"\n        Метод получения Session_ID в Metabase через API.\n    \n        :param cookies: Куки авторизации\n        :return: last_code: Последний созданный код в таблице\n        \"\"\"\n        cookies = cookies\n        json = {\"type\": \"query\",\n                \"query\": {\"source-table\": 121,\n                          \"filter\": [\"time-interval\",\n                                     [\"field\", 726, None],\n                                     \"current\",\n                                     \"day\",\n                                     {\"include_current\": True}],\n                          \"order-by\": [[\"desc\", [\"field\", 728, None]]]},\n                \"database\": 5,\n                \"parameters\": []}\n        time.sleep(1)\n        response = requests.post(url=MetaBaseLinks.DATA_SATE, cookies=cookies, json=json)\n>       last_code = response.json()['data']['rows'][0][7]\nE       IndexError: list index out of range\n\nmodel/api/metabase.py:53: IndexError","steps":[{"name":"Открыть страницу авторизации","time":{"start":1721683237309,"stop":1721683239995,"duration":2686},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"hasContent":false,"attachmentStep":false,"attachmentsCount":0},{"name":"Нажать кнопку \"По смс (Для России)\"","time":{"start":1721683239995,"stop":1721683243054,"duration":3059},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"hasContent":false,"attachmentStep":false,"attachmentsCount":0},{"name":"Нажать кнопку Далее","time":{"start":1721683243055,"stop":1721683244602,"duration":1547},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"hasContent":false,"attachmentStep":false,"attachmentsCount":0},{"name":"В поле никнейм ввести любое валидное значение","time":{"start":1721683244602,"stop":1721683246179,"duration":1577},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"hasContent":false,"attachmentStep":false,"attachmentsCount":0},{"name":"Нажать кнопку Далее","time":{"start":1721683246179,"stop":1721683246216,"duration":37},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"hasContent":false,"attachmentStep":false,"attachmentsCount":0},{"name":"В поле Пароль ввести пароль","time":{"start":1721683246216,"stop":1721683247770,"duration":1554},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"hasContent":false,"attachmentStep":false,"attachmentsCount":0},{"name":"В поле Повтори пароль ввести пароль еще раз","time":{"start":1721683247770,"stop":1721683247816,"duration":46},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"hasContent":false,"attachmentStep":false,"attachmentsCount":0},{"name":"Нажать кнопку далее","time":{"start":1721683247816,"stop":1721683247855,"duration":39},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"hasContent":false,"attachmentStep":false,"attachmentsCount":0},{"name":"Ввести номер телефона в поле номер телефона","time":{"start":1721683247855,"stop":1721683249417,"duration":1562},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"hasContent":false,"attachmentStep":false,"attachmentsCount":0},{"name":"Нажать кнопку далее","time":{"start":1721683249417,"stop":1721683249454,"duration":37},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"hasContent":false,"attachmentStep":false,"attachmentsCount":0},{"name":"Авторизоваться в MetaBase","time":{"start":1721683249454,"stop":1721683250674,"duration":1220},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"hasContent":false,"attachmentStep":false,"attachmentsCount":0},{"name":"Проверяем, что код пришел","time":{"start":1721683250674,"stop":1721683252699,"duration":2025},"status":"broken","statusMessage":"IndexError: list index out of range\n","statusTrace":"  File \"/usr/workspace/tests/test_registration.py\", line 281, in test_receiving_sms_with_registration_confirmation_code\n    sms_code = self.metabase.take_last_code(metabase)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/workspace/model/api/metabase.py\", line 53, in take_last_code\n    last_code = response.json()['data']['rows'][0][7]\n                ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^\n","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"hasContent":true,"attachmentStep":false,"attachmentsCount":0}],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":12,"hasContent":true,"attachmentStep":false,"attachmentsCount":0},"afterStages":[{"name":"driver::0","time":{"start":1721683252713,"stop":1721683252894,"duration":181},"status":"passed","steps":[],"attachments":[{"uid":"11211c1557c51974","name":"page_source","source":"11211c1557c51974.html","type":"text/html","size":13206},{"uid":"804af583221f0370","name":"screenshot","source":"804af583221f0370.png","type":"image/png","size":21866},{"uid":"8324533ef158587b","name":"browser_logs","source":"8324533ef158587b.txt","type":"text/plain","size":2199}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"hasContent":true,"attachmentStep":false,"attachmentsCount":3}],"labels":[{"name":"severity","value":"Critical"},{"name":"feature","value":"Регистрация пользователя"},{"name":"tag","value":"regression"},{"name":"parentSuite","value":"tests"},{"name":"suite","value":"test_registration"},{"name":"subSuite","value":"TestRegistrationUser"},{"name":"host","value":"09567fd04e0a"},{"name":"thread","value":"1-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_registration"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"critical","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":0,"broken":4,"skipped":0,"passed":11,"unknown":0,"total":15},"items":[{"uid":"2f59afcfd71f9632","status":"passed","time":{"start":1721671783481,"stop":1721671796567,"duration":13086}},{"uid":"2f632e38459b092b","status":"broken","statusDetails":"selenium.common.exceptions.TimeoutException: Message: Не найден элемент с локатором ('xpath', '//input[@name=\"password\"]')","time":{"start":1721668599442,"stop":1721668636052,"duration":36610}},{"uid":"87ae11706f3b7474","status":"passed","time":{"start":1720802799490,"stop":1720802813809,"duration":14319}},{"uid":"6c67b26eb499de24","status":"passed","time":{"start":1720800508986,"stop":1720800521744,"duration":12758}},{"uid":"68fa2b54fc32eebb","status":"broken","statusDetails":"selenium.common.exceptions.TimeoutException: Message: Не найден элемент с локатором ('xpath', '//input[@name=\"password\"]')","time":{"start":1720730149297,"stop":1720730185981,"duration":36684}},{"uid":"22c5dd639d413055","status":"passed","time":{"start":1720638966803,"stop":1720638980503,"duration":13700}},{"uid":"500cebfa2d09f7bd","status":"passed","time":{"start":1720637791287,"stop":1720637806906,"duration":15619}},{"uid":"db0a210b4215faa8","status":"passed","time":{"start":1720637366122,"stop":1720637378889,"duration":12767}},{"uid":"ba554edc90a5e771","status":"passed","time":{"start":1720553962289,"stop":1720553978043,"duration":15754}},{"uid":"b4052c83f7c24872","status":"passed","time":{"start":1720551886443,"stop":1720551899736,"duration":13293}},{"uid":"9a446809a3c36d69","status":"passed","time":{"start":1720551421793,"stop":1720551434276,"duration":12483}},{"uid":"9c14b608b79a3c19","status":"passed","time":{"start":1720546306576,"stop":1720546319284,"duration":12708}},{"uid":"c507f70a544beb24","status":"broken","statusDetails":"selenium.common.exceptions.TimeoutException: Message: Не найден элемент с локатором ('xpath', '//input[@name=\"password\"]')","time":{"start":1720470672671,"stop":1720470709479,"duration":36808}},{"uid":"e679664c3fb1fcf9","status":"passed","time":{"start":1720469458239,"stop":1720469473448,"duration":15209}}]},"tags":["regression"]},"source":"b030d277aa8669bf.json","parameterValues":[]}